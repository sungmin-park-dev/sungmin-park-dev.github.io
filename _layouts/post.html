---
layout: base
---

<!-- MathJax (only if page.math is true) -->
{% if page.math %}
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
{% endif %}

<!-- Background -->
<div class="page-bg"></div>

<!-- Top Navigation -->
{% include nav.html %}

<!-- Post Container -->
<div class="post-container">
  <!-- Left Sidebar: TOC + Tags -->
  {% if page.toc %}
  <aside class="left-sidebar">
    <!-- TOC -->
    <div class="sidebar-section toc-section">
      <h3 class="sidebar-title">Contents</h3>
      <div id="toc-content"></div>
    </div>

    <!-- Tags -->
    {% if page.tags.size > 0 %}
    <div class="sidebar-section tags-section">
      <h3 class="sidebar-title">Tags</h3>
      <div class="sidebar-tags">
        {% for tag in page.tags %}
          <span class="sidebar-tag">{{ tag }}</span>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </aside>
  {% endif %}

  <!-- Main Content -->
  <article class="post-content">
    <!-- Breadcrumb -->
    {% assign url_parts = page.url | split: '/' | where_exp: "part", "part != ''" %}
    {% assign collection_root = url_parts[0] %}

    <nav class="breadcrumb">
      <a href="/" class="breadcrumb-item">Home</a>
      <span class="breadcrumb-separator">›</span>
      <a href="/{{ collection_root }}/" class="breadcrumb-item">{{ collection_root }}</a>
      {% if url_parts.size > 2 %}
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item">{{ url_parts[1] | replace: '-', ' ' | capitalize }}</span>
      {% endif %}
    </nav>

    <!-- Post Header -->
    <header class="post-header">
      <h1 class="post-title">{{ page.title }}</h1>

      <div class="post-meta">
        {% if page.date %}
          <span class="post-date">
            <i class="far fa-calendar"></i>
            {{ page.date | date: "%B %d, %Y" }}
          </span>
        {% endif %}

        {% if page.tags.size > 0 %}
          <div class="post-tags">
            {% for tag in page.tags %}
              <span class="post-tag">{{ tag }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </header>

    <!-- Post Body -->
    <div class="post-body">
      {{ content }}
    </div>

    <!-- Related Posts -->
    {% if page.tags.size > 0 %}
      {% assign related_posts = '' | split: '' %}
      {% for post in site[page.collection] %}
        {% if post.url != page.url and post.published != false %}
          {% assign common_tags = 0 %}
          {% for tag in post.tags %}
            {% if page.tags contains tag %}
              {% assign common_tags = common_tags | plus: 1 %}
            {% endif %}
          {% endfor %}
          {% if common_tags > 0 %}
            {% assign related_posts = related_posts | push: post %}
          {% endif %}
        {% endif %}
      {% endfor %}

      {% if related_posts.size > 0 %}
        <section class="related-posts">
          <h2 class="related-title">Related Posts</h2>
          <div class="related-grid">
            {% for post in related_posts limit:3 %}
              <a href="{{ post.url }}" class="related-card">
                <h3 class="related-card-title">{{ post.title }}</h3>
                {% if post.description %}
                  <p class="related-card-desc">{{ post.description }}</p>
                {% endif %}
                {% if post.date %}
                  <span class="related-card-date">{{ post.date | date: "%b %d, %Y" }}</span>
                {% endif %}
              </a>
            {% endfor %}
          </div>
        </section>
      {% endif %}
    {% endif %}

    <!-- Prev/Next Navigation -->
    {% if page.collection %}
      {% assign collection = site[page.collection] | where_exp: "item", "item.published != false" | sort: "date" %}
      {% assign current_index = -1 %}
      {% for item in collection %}
        {% if item.url == page.url %}
          {% assign current_index = forloop.index0 %}
          {% break %}
        {% endif %}
      {% endfor %}

      {% if current_index >= 0 %}
        {% assign prev_index = current_index | minus: 1 %}
        {% assign next_index = current_index | plus: 1 %}

        <nav class="post-navigation">
          <div class="nav-previous">
            {% if prev_index >= 0 %}
              {% assign prev_post = collection[prev_index] %}
              <a href="{{ prev_post.url }}" class="nav-link">
                <span class="nav-label">← Previous</span>
                <span class="nav-title">{{ prev_post.title }}</span>
              </a>
            {% endif %}
          </div>

          <div class="nav-next">
            {% if next_index < collection.size %}
              {% assign next_post = collection[next_index] %}
              <a href="{{ next_post.url }}" class="nav-link">
                <span class="nav-label">Next →</span>
                <span class="nav-title">{{ next_post.title }}</span>
              </a>
            {% endif %}
          </div>
        </nav>
      {% endif %}
    {% endif %}

    <!-- Comments (Utterances) -->
    {% if page.comments != false %}
      <div class="post-comments">
        <script src="https://utteranc.es/client.js"
          repo="{{ site.comments.utterances.repo }}"
          issue-term="{{ site.comments.utterances.issue_term }}"
          theme="photon-dark"
          crossorigin="anonymous"
          async>
        </script>
      </div>
    {% endif %}
  </article>
</div>

<!-- TOC JavaScript -->
{% if page.toc %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var postBody = document.querySelector('.post-body');
    var tocContent = document.getElementById('toc-content');

    if (!postBody || !tocContent) return;

    var headings = postBody.querySelectorAll('h2, h3');
    if (headings.length === 0) {
      var sidebar = document.querySelector('.left-sidebar');
      if (sidebar) sidebar.style.display = 'none';
      return;
    }

    var toc = document.createElement('ul');
    toc.className = 'toc-list';

    headings.forEach(function(heading, index) {
      var id = heading.id || ('heading-' + index);
      heading.id = id;

      var li = document.createElement('li');
      li.className = 'toc-item toc-' + heading.tagName.toLowerCase();

      var a = document.createElement('a');
      a.href = '#' + id;
      a.textContent = heading.textContent;
      a.className = 'toc-link';

      li.appendChild(a);
      toc.appendChild(li);
    });

    tocContent.appendChild(toc);

    window.addEventListener('scroll', function() {
      var current = '';
      headings.forEach(function(heading) {
        var rect = heading.getBoundingClientRect();
        if (rect.top <= 150) current = heading.id;
      });

      document.querySelectorAll('.toc-link').forEach(function(link) {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + current) {
          link.classList.add('active');
        }
      });
    });
  });
</script>
{% endif %}
